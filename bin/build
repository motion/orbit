#!/bin/bash

. $(dirname $0)/__/common

if [ "$(realpath .)" = "$ROOT" ]; then
  echo "building.... $(pwd)"
  # build
  if [ "$1" = "" ]; then
    ARGS=${@:1}
    (bin/in ui npm run build) &
    (bin/in store-hmr npm run build) &
    wait
    (cd app && tsc --build $ARGS)
    wait
  fi
  # build --watch
  if [ "$1" = "--watch" ]; then
    ARGS=${@:2}
    (cd app && tsc --build --watch --preserveWatchOutput $ARGS) &
    (bin/in ui npm run watch) &
    (bin/in store-hmr npm run build --watch) &
    wait
  fi
  exit 0
fi

