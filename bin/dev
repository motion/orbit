#!/bin/bash

# set env then source
export ENV="dev"

. $(dirname $0)/__common
cd $ROOT

# set dev context
export KUBECONFIG=infra/keys/kubes/dev
kubectl config use-context minikube > /dev/null

ACTION=$1

# PRE RUN
if [ "$DOCKER_TLS_VERIFY" != "1" ]; then
  if minikube docker-env > /dev/null 2>&1; then
    eval $(minikube docker-env)
  else
    echo "no minikube docker-env"
  fi
fi

# RUN
if [ "$ACTION" = "ui" ]; then
  minikube dashboard
elif [ "$ACTION" = "open" ]; then
  open $(minikube service pad-public --url)
else
  bin/__kubes ${@:1}
fi

# POST RUN
if [ "$ACTION" = "stop" ]; then
  minikube stop
fi
