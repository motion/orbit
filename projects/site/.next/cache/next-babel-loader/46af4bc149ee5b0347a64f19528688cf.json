{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport { Button, ErrorBoundary, FullScreen, Portal, ProvideUI, Theme, Title, View } from '@o/ui';\nimport { useForceUpdate } from '@o/use-store';\nimport { isDefined } from '@o/utils';\nimport { throttle } from 'lodash';\nimport React, { memo, useCallback, useEffect, useLayoutEffect, useState } from 'react';\nimport { NotFoundBoundary, useCurrentRoute, useLoadingRoute } from 'react-navi';\nimport { scrollTo } from './etc/helpers';\nimport { Header } from './Header';\nimport { useScreenSize } from './hooks/useScreenSize';\nimport { useSiteStore } from './SiteStore';\nimport { themes } from './themes';\nimport { BusyIndicator } from './views/BusyIndicator';\nimport { useFadePage } from './views/FadeInView';\nimport { HeaderLink, LinksLeft, LinksRight } from './views/HeaderLink';\nvar transition = 'transform ease 300ms';\nvar updateLayout = null;\nexport var usePageTheme = () => {\n  var forceUpdate = useForceUpdate();\n  var route = useCurrentRoute();\n  var curView = route.views.find(x => x && x.type && x.type.theme);\n  var key = \"theme-\" + (route.url.pathname.split('/')[1] || '');\n  var theme = localStorage.getItem(key) || curView && curView.type && curView.type.theme || 'home';\n  return [theme, useCallback(next => {\n    localStorage.setItem(key, next);\n    forceUpdate();\n    updateLayout();\n  }, [key])];\n};\n\n__signature__(usePageTheme, \"useForceUpdate{forceUpdate}\\nuseCurrentRoute{route}\\nuseCallback{}\", () => [useForceUpdate, useCurrentRoute]);\n\nvar PageLoading = memo(__signature__(() => {\n  var loadingRoute = useLoadingRoute();\n  return React.createElement(BusyIndicator, {\n    color: \"#FE5C58\",\n    isBusy: !!loadingRoute,\n    delayMs: 50\n  });\n}, \"useLoadingRoute{loadingRoute}\", () => [useLoadingRoute]));\nPageLoading.displayName = \"PageLoading\";\nexport var Layout = memo(__signature__(props => {\n  var forceUpdate = useForceUpdate();\n  updateLayout = forceUpdate;\n  var siteStore = useSiteStore();\n  var screen = useScreenSize();\n  var sidebarWidth = 300;\n  var route = useCurrentRoute();\n  var [theme] = usePageTheme();\n  useEffect(() => {\n    siteStore.screenSize = screen;\n  }, [screen]);\n  useEffect(() => {\n    if (window.location.hash) {\n      if (document.querySelector(window.location.hash)) {\n        scrollTo(window.location.hash);\n      }\n    }\n  }, [route]);\n  useEffect(() => {\n    window.addEventListener('resize', throttle(() => {\n      siteStore.windowHeight = window.innerHeight;\n    }, 64));\n  }, []);\n  var maxHeight = siteStore.showSidebar ? window.innerHeight : siteStore.maxHeight;\n  useLayoutEffect(() => {\n    document.body.style.background = themes[theme].background.toString();\n  }, [theme]);\n  return React.createElement(ProvideUI, {\n    themes: themes,\n    activeTheme: theme\n  }, React.createElement(PageLoading, null), React.createElement(PeekHeader, {\n    isActive: route.views.some(x => x.type && x.type.showPeekHeader)\n  }), React.createElement(View, {\n    className: \"theme-\" + theme,\n    minHeight: \"100vh\",\n    minWidth: \"100vw\",\n    overflow: isDefined(maxHeight) ? 'hidden' : 'visible',\n    transition: transition,\n    style: {\n      maxHeight,\n      // WARNING dont have translate here it ruins sticky sidebar\n      transform: siteStore.showSidebar ? \"translateX(\" + -sidebarWidth + \"px)\" : \"\"\n    }\n  }, React.createElement(ErrorBoundary, {\n    name: \"Site Error\"\n  }, React.createElement(NotFoundBoundary, {\n    render: NotFound\n  }, props.children))), React.createElement(LayoutSidebar, null));\n}, \"useForceUpdate{forceUpdate}\\nuseSiteStore{siteStore}\\nuseScreenSize{screen}\\nuseCurrentRoute{route}\\nusePageTheme{[theme]}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseLayoutEffect{}\", () => [useForceUpdate, useSiteStore, useScreenSize, useCurrentRoute, usePageTheme]));\nLayout.displayName = \"Layout\";\nvar LayoutSidebar = memo(__signature__(() => {\n  var siteStore = useSiteStore();\n  var sidebarWidth = 300;\n  var Fade = useFadePage();\n  var linkProps = {\n    width: '100%',\n    padding: 20,\n    fontSize: 22,\n    textAlign: 'left',\n    onMouseUp: () => {\n      siteStore.toggleSidebar();\n    }\n  };\n  return React.createElement(Portal, {\n    prepend: true,\n    style: {\n      zIndex: 100000000\n    }\n  }, React.createElement(Theme, {\n    name: \"home\"\n  }, React.createElement(View, {\n    nodeRef: Fade.ref,\n    pointerEvents: \"auto\",\n    position: \"fixed\",\n    top: 0,\n    right: 0,\n    height: \"100vh\",\n    transition: transition,\n    background: bg,\n    style: {\n      width: sidebarWidth,\n      transform: \"translateX(\" + (siteStore.showSidebar ? 0 : sidebarWidth) + \"px)\"\n    }\n  }, React.createElement(Button, {\n    position: \"absolute\",\n    top: 20,\n    right: 20,\n    chromeless: true,\n    icon: \"cross\",\n    iconSize: 16,\n    zIndex: 1000,\n    cursor: \"pointer\",\n    onClick: siteStore.toggleSidebar\n  }), React.createElement(Fade.FadeProvide, null, React.createElement(HeaderLink, _extends({\n    href: \"/\"\n  }, linkProps), \"Home\"), React.createElement(LinksLeft, linkProps), React.createElement(LinksRight, linkProps)))));\n}, \"useSiteStore{siteStore}\\nuseFadePage{Fade}\", () => [useSiteStore, useFadePage]));\nLayoutSidebar.displayName = \"LayoutSidebar\";\n\nvar bg = theme => theme.background;\n\nfunction NotFound() {\n  return React.createElement(View, null, React.createElement(Title, null, \"Not found\"));\n}\n\nNotFound.displayName = \"NotFound\";\nvar PeekHeader = memo(__signature__(props => {\n  var [show, setShow] = useState(false);\n  useEffect(() => {\n    var el = document.documentElement;\n    var top = el.scrollTop;\n    var direction = 'down';\n    var onScroll = throttle(() => {\n      var next = el.scrollTop;\n      direction = next >= top ? 'down' : 'up'; // avoid small moves\n\n      var diff = direction === 'down' ? next - top : top - next;\n\n      if (diff < 150) {\n        return;\n      }\n\n      top = next;\n\n      if (direction === 'up' && top > 300) {\n        setShow(true);\n      } else {\n        setShow(false);\n      }\n    }, 100);\n    window.addEventListener('scroll', onScroll, {\n      passive: true\n    });\n    return () => {\n      window.removeEventListener('scroll', onScroll);\n    };\n  }, []);\n\n  if (!props.isActive) {\n    return null;\n  }\n\n  return React.createElement(Theme, {\n    name: \"home\"\n  }, React.createElement(FullScreen, {\n    zIndex: 100000000,\n    position: \"fixed\",\n    bottom: \"auto\",\n    transition: \"all ease 200ms\",\n    opacity: show ? 1 : 0,\n    transform: {\n      y: show ? 0 : -40\n    },\n    className: \"peek-header\"\n  }, React.createElement(Header, {\n    slim: true,\n    boxShadow: [[0, 0, 30, [0, 0, 0, 1]]]\n  })));\n}, \"useState{[show, setShow](false)}\\nuseEffect{}\"));\nPeekHeader.displayName = \"PeekHeader\";\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(transition, \"transition\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n  reactHotLoader.register(updateLayout, \"updateLayout\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n  reactHotLoader.register(usePageTheme, \"usePageTheme\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n  reactHotLoader.register(PageLoading, \"PageLoading\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n  reactHotLoader.register(Layout, \"Layout\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n  reactHotLoader.register(LayoutSidebar, \"LayoutSidebar\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n  reactHotLoader.register(bg, \"bg\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n  reactHotLoader.register(NotFound, \"NotFound\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n  reactHotLoader.register(PeekHeader, \"PeekHeader\", \"/Users/nw/projects/motion/orbit/projects/site/Layout.tsx\");\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/Users/nw/projects/motion/orbit/projects/site/Layout.tsx"],"names":["Button","ErrorBoundary","FullScreen","Portal","ProvideUI","Theme","Title","View","useForceUpdate","isDefined","throttle","React","memo","useCallback","useEffect","useLayoutEffect","useState","NotFoundBoundary","useCurrentRoute","useLoadingRoute","scrollTo","Header","useScreenSize","useSiteStore","themes","BusyIndicator","useFadePage","HeaderLink","LinksLeft","LinksRight","transition","updateLayout","usePageTheme","forceUpdate","route","curView","views","find","x","type","theme","key","url","pathname","split","localStorage","getItem","next","setItem","PageLoading","loadingRoute","Layout","props","siteStore","screen","sidebarWidth","screenSize","window","location","hash","document","querySelector","addEventListener","windowHeight","innerHeight","maxHeight","showSidebar","body","style","background","toString","some","showPeekHeader","transform","NotFound","children","LayoutSidebar","Fade","linkProps","width","padding","fontSize","textAlign","onMouseUp","toggleSidebar","zIndex","ref","bg","PeekHeader","show","setShow","el","documentElement","top","scrollTop","direction","onScroll","diff","passive","removeEventListener","isActive","y"],"mappings":";;;;;;;;;;;AAAA,SAASA,MAAT,EAAiBC,aAAjB,EAAgCC,UAAhC,EAA4CC,MAA5C,EAAoDC,SAApD,EAA+DC,KAA/D,EAAsEC,KAAtE,EAA6EC,IAA7E,QAAyF,OAAzF;AACA,SAASC,cAAT,QAA+B,cAA/B;AACA,SAASC,SAAT,QAA0B,UAA1B;AACA,SAASC,QAAT,QAAyB,QAAzB;AACA,OAAOC,KAAP,IAAgBC,IAAhB,EAAsBC,WAAtB,EAAmCC,SAAnC,EAA8CC,eAA9C,EAA+DC,QAA/D,QAA+E,OAA/E;AACA,SAASC,gBAAT,EAA2BC,eAA3B,EAA4CC,eAA5C,QAAmE,YAAnE;AAEA,SAASC,QAAT,QAAyB,eAAzB;AACA,SAASC,MAAT,QAAuB,UAAvB;AACA,SAASC,aAAT,QAA8B,uBAA9B;AACA,SAASC,YAAT,QAA6B,aAA7B;AACA,SAASC,MAAT,QAAuB,UAAvB;AACA,SAASC,aAAT,QAA8B,uBAA9B;AACA,SAASC,WAAT,QAA4B,oBAA5B;AACA,SAASC,UAAT,EAAqBC,SAArB,EAAgCC,UAAhC,QAAkD,oBAAlD;AAEA,IAAMC,UAAU,GAAG,sBAAnB;AAEA,IAAIC,YAAY,GAAG,IAAnB;AAEA,OAAO,IAAMC,YAAY,GAAG,MAAM;AAChC,MAAMC,WAAW,GAAGzB,cAAc,EAAlC;AACA,MAAM0B,KAAK,GAAGhB,eAAe,EAA7B;AACA,MAAMiB,OAAO,GAAGD,KAAK,CAACE,KAAN,CAAYC,IAAZ,CAAiBC,CAAC,IAAIA,CAAC,IAAIA,CAAC,CAACC,IAAP,IAAeD,CAAC,CAACC,IAAF,CAAOC,KAA5C,CAAhB;AACA,MAAMC,GAAG,eAAYP,KAAK,CAACQ,GAAN,CAAUC,QAAV,CAAmBC,KAAnB,CAAyB,GAAzB,EAA8B,CAA9B,KAAoC,EAAhD,CAAT;AACA,MAAMJ,KAAK,GACTK,YAAY,CAACC,OAAb,CAAqBL,GAArB,KAA8BN,OAAO,IAAIA,OAAO,CAACI,IAAnB,IAA2BJ,OAAO,CAACI,IAAR,CAAaC,KAAtE,IAAgF,MADlF;AAEA,SAAO,CACLA,KADK,EAEL3B,WAAW,CACTkC,IAAI,IAAI;AACNF,IAAAA,YAAY,CAACG,OAAb,CAAqBP,GAArB,EAA0BM,IAA1B;AACAd,IAAAA,WAAW;AACXF,IAAAA,YAAY;AACb,GALQ,EAMT,CAACU,GAAD,CANS,CAFN,CAAP;AAWD,CAlBM;;cAAMT,Y,+EACSxB,c,EACNU,e;;AAkBhB,IAAM+B,WAAW,GAAGrC,IAAI,eAAC,MAAM;AAC7B,MAAMsC,YAAY,GAAG/B,eAAe,EAApC;AACA,SAAO,oBAAC,aAAD;AAAe,IAAA,KAAK,EAAC,SAArB;AAA+B,IAAA,MAAM,EAAE,CAAC,CAAC+B,YAAzC;AAAuD,IAAA,OAAO,EAAE;AAAhE,IAAP;AACD,CAHuB,0CACD/B,eADC,GAAxB;AAAM8B,W;AAKN,OAAO,IAAME,MAAM,GAAGvC,IAAI,eAAEwC,KAAD,IAAgB;AACzC,MAAMnB,WAAW,GAAGzB,cAAc,EAAlC;AACAuB,EAAAA,YAAY,GAAGE,WAAf;AACA,MAAMoB,SAAS,GAAG9B,YAAY,EAA9B;AACA,MAAM+B,MAAM,GAAGhC,aAAa,EAA5B;AACA,MAAMiC,YAAY,GAAG,GAArB;AACA,MAAMrB,KAAK,GAAGhB,eAAe,EAA7B;AACA,MAAM,CAACsB,KAAD,IAAUR,YAAY,EAA5B;AAEAlB,EAAAA,SAAS,CAAC,MAAM;AACduC,IAAAA,SAAS,CAACG,UAAV,GAAuBF,MAAvB;AACD,GAFQ,EAEN,CAACA,MAAD,CAFM,CAAT;AAIAxC,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI2C,MAAM,CAACC,QAAP,CAAgBC,IAApB,EAA0B;AACxB,UAAIC,QAAQ,CAACC,aAAT,CAAuBJ,MAAM,CAACC,QAAP,CAAgBC,IAAvC,CAAJ,EAAkD;AAChDvC,QAAAA,QAAQ,CAACqC,MAAM,CAACC,QAAP,CAAgBC,IAAjB,CAAR;AACD;AACF;AACF,GANQ,EAMN,CAACzB,KAAD,CANM,CAAT;AAQApB,EAAAA,SAAS,CAAC,MAAM;AACd2C,IAAAA,MAAM,CAACK,gBAAP,CACE,QADF,EAEEpD,QAAQ,CAAC,MAAM;AACb2C,MAAAA,SAAS,CAACU,YAAV,GAAyBN,MAAM,CAACO,WAAhC;AACD,KAFO,EAEL,EAFK,CAFV;AAMD,GAPQ,EAON,EAPM,CAAT;AASA,MAAMC,SAAS,GAAGZ,SAAS,CAACa,WAAV,GAAwBT,MAAM,CAACO,WAA/B,GAA6CX,SAAS,CAACY,SAAzE;AAEAlD,EAAAA,eAAe,CAAC,MAAM;AACpB6C,IAAAA,QAAQ,CAACO,IAAT,CAAcC,KAAd,CAAoBC,UAApB,GAAiC7C,MAAM,CAACgB,KAAD,CAAN,CAAc6B,UAAd,CAAyBC,QAAzB,EAAjC;AACD,GAFc,EAEZ,CAAC9B,KAAD,CAFY,CAAf;AAIA,SACE,oBAAC,SAAD;AAAW,IAAA,MAAM,EAAEhB,MAAnB;AAA2B,IAAA,WAAW,EAAEgB;AAAxC,KACE,oBAAC,WAAD,OADF,EAEE,oBAAC,UAAD;AAAY,IAAA,QAAQ,EAAEN,KAAK,CAACE,KAAN,CAAYmC,IAAZ,CAAiBjC,CAAC,IAAIA,CAAC,CAACC,IAAF,IAAUD,CAAC,CAACC,IAAF,CAAOiC,cAAvC;AAAtB,IAFF,EAGE,oBAAC,IAAD;AACE,IAAA,SAAS,aAAWhC,KADtB;AAEE,IAAA,SAAS,EAAC,OAFZ;AAGE,IAAA,QAAQ,EAAC,OAHX;AAIE,IAAA,QAAQ,EAAE/B,SAAS,CAACwD,SAAD,CAAT,GAAuB,QAAvB,GAAkC,SAJ9C;AAKE,IAAA,UAAU,EAAEnC,UALd;AAME,IAAA,KAAK,EAAE;AACLmC,MAAAA,SADK;AAEL;AACAQ,MAAAA,SAAS,EAAEpB,SAAS,CAACa,WAAV,mBAAsC,CAACX,YAAvC;AAHN;AANT,KAYE,oBAAC,aAAD;AAAe,IAAA,IAAI,EAAC;AAApB,KACE,oBAAC,gBAAD;AAAkB,IAAA,MAAM,EAAEmB;AAA1B,KAAqCtB,KAAK,CAACuB,QAA3C,CADF,CAZF,CAHF,EAmBE,oBAAC,aAAD,OAnBF,CADF;AAuBD,CA3DyB,iMACJnE,cADI,EAGNe,YAHM,EAITD,aAJS,EAMVJ,eANU,EAORc,YAPQ,GAAnB;AAAMmB,M;AA6Db,IAAMyB,aAAa,GAAGhE,IAAI,eAAC,MAAM;AAC/B,MAAMyC,SAAS,GAAG9B,YAAY,EAA9B;AACA,MAAMgC,YAAY,GAAG,GAArB;AACA,MAAMsB,IAAI,GAAGnD,WAAW,EAAxB;AAEA,MAAMoD,SAAS,GAAG;AAChBC,IAAAA,KAAK,EAAE,MADS;AAEhBC,IAAAA,OAAO,EAAE,EAFO;AAGhBC,IAAAA,QAAQ,EAAE,EAHM;AAIhBC,IAAAA,SAAS,EAAE,MAJK;AAKhBC,IAAAA,SAAS,EAAE,MAAM;AACf9B,MAAAA,SAAS,CAAC+B,aAAV;AACD;AAPe,GAAlB;AAUA,SACE,oBAAC,MAAD;AAAQ,IAAA,OAAO,MAAf;AAAgB,IAAA,KAAK,EAAE;AAAEC,MAAAA,MAAM,EAAE;AAAV;AAAvB,KACE,oBAAC,KAAD;AAAO,IAAA,IAAI,EAAC;AAAZ,KACE,oBAAC,IAAD;AACE,IAAA,OAAO,EAAER,IAAI,CAACS,GADhB;AAEE,IAAA,aAAa,EAAC,MAFhB;AAGE,IAAA,QAAQ,EAAC,OAHX;AAIE,IAAA,GAAG,EAAE,CAJP;AAKE,IAAA,KAAK,EAAE,CALT;AAME,IAAA,MAAM,EAAC,OANT;AAOE,IAAA,UAAU,EAAExD,UAPd;AAQE,IAAA,UAAU,EAAEyD,EARd;AASE,IAAA,KAAK,EAAE;AACLR,MAAAA,KAAK,EAAExB,YADF;AAELkB,MAAAA,SAAS,mBAAgBpB,SAAS,CAACa,WAAV,GAAwB,CAAxB,GAA4BX,YAA5C;AAFJ;AATT,KAcE,oBAAC,MAAD;AACE,IAAA,QAAQ,EAAC,UADX;AAEE,IAAA,GAAG,EAAE,EAFP;AAGE,IAAA,KAAK,EAAE,EAHT;AAIE,IAAA,UAAU,MAJZ;AAKE,IAAA,IAAI,EAAC,OALP;AAME,IAAA,QAAQ,EAAE,EANZ;AAOE,IAAA,MAAM,EAAE,IAPV;AAQE,IAAA,MAAM,EAAC,SART;AASE,IAAA,OAAO,EAAEF,SAAS,CAAC+B;AATrB,IAdF,EAyBE,oBAAC,IAAD,CAAM,WAAN,QACE,oBAAC,UAAD;AAAY,IAAA,IAAI,EAAC;AAAjB,KAAyBN,SAAzB,UADF,EAIE,oBAAC,SAAD,EAAeA,SAAf,CAJF,EAKE,oBAAC,UAAD,EAAgBA,SAAhB,CALF,CAzBF,CADF,CADF,CADF;AAuCD,CAtDyB,uDACNvD,YADM,EAGXG,WAHW,GAA1B;AAAMkD,a;;AAwDN,IAAMW,EAAE,GAAG/C,KAAK,IAAIA,KAAK,CAAC6B,UAA1B;;AAEA,SAASK,QAAT,GAAoB;AAClB,SACE,oBAAC,IAAD,QACE,oBAAC,KAAD,oBADF,CADF;AAKD;;AANQA,Q;AAQT,IAAMc,UAAU,GAAG5E,IAAI,eAAEwC,KAAD,IAAmC;AACzD,MAAM,CAACqC,IAAD,EAAOC,OAAP,IAAkB1E,QAAQ,CAAC,KAAD,CAAhC;AAEAF,EAAAA,SAAS,CAAC,MAAM;AACd,QAAM6E,EAAE,GAAG/B,QAAQ,CAACgC,eAApB;AAEA,QAAIC,GAAG,GAAGF,EAAE,CAACG,SAAb;AACA,QAAIC,SAAwB,GAAG,MAA/B;AAEA,QAAMC,QAAQ,GAAGtF,QAAQ,CAAC,MAAM;AAC9B,UAAMqC,IAAI,GAAG4C,EAAE,CAACG,SAAhB;AACAC,MAAAA,SAAS,GAAGhD,IAAI,IAAI8C,GAAR,GAAc,MAAd,GAAuB,IAAnC,CAF8B,CAI9B;;AACA,UAAMI,IAAI,GAAGF,SAAS,KAAK,MAAd,GAAuBhD,IAAI,GAAG8C,GAA9B,GAAoCA,GAAG,GAAG9C,IAAvD;;AACA,UAAIkD,IAAI,GAAG,GAAX,EAAgB;AACd;AACD;;AAEDJ,MAAAA,GAAG,GAAG9C,IAAN;;AAEA,UAAIgD,SAAS,KAAK,IAAd,IAAsBF,GAAG,GAAG,GAAhC,EAAqC;AACnCH,QAAAA,OAAO,CAAC,IAAD,CAAP;AACD,OAFD,MAEO;AACLA,QAAAA,OAAO,CAAC,KAAD,CAAP;AACD;AACF,KAjBwB,EAiBtB,GAjBsB,CAAzB;AAmBAjC,IAAAA,MAAM,CAACK,gBAAP,CAAwB,QAAxB,EAAkCkC,QAAlC,EAA4C;AAAEE,MAAAA,OAAO,EAAE;AAAX,KAA5C;AAEA,WAAO,MAAM;AACXzC,MAAAA,MAAM,CAAC0C,mBAAP,CAA2B,QAA3B,EAAqCH,QAArC;AACD,KAFD;AAGD,GA9BQ,EA8BN,EA9BM,CAAT;;AAgCA,MAAI,CAAC5C,KAAK,CAACgD,QAAX,EAAqB;AACnB,WAAO,IAAP;AACD;;AAED,SACE,oBAAC,KAAD;AAAO,IAAA,IAAI,EAAC;AAAZ,KACE,oBAAC,UAAD;AACE,IAAA,MAAM,EAAE,SADV;AAEE,IAAA,QAAQ,EAAC,OAFX;AAGE,IAAA,MAAM,EAAC,MAHT;AAIE,IAAA,UAAU,EAAC,gBAJb;AAKE,IAAA,OAAO,EAAEX,IAAI,GAAG,CAAH,GAAO,CALtB;AAME,IAAA,SAAS,EAAE;AAAEY,MAAAA,CAAC,EAAEZ,IAAI,GAAG,CAAH,GAAO,CAAC;AAAjB,KANb;AAOE,IAAA,SAAS,EAAC;AAPZ,KASE,oBAAC,MAAD;AAAQ,IAAA,IAAI,MAAZ;AAAa,IAAA,SAAS,EAAE,CAAC,CAAC,CAAD,EAAI,CAAJ,EAAO,EAAP,EAAW,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAX,CAAD;AAAxB,IATF,CADF,CADF;AAeD,CAtDsB,mDAAvB;AAAMD,U;;;;;;;;;;0BA5JA1D,U;0BAEFC,Y;0BAESC,Y;0BAoBPiB,W;0BAKOE,M;0BA6DPyB,a;0BAwDAW,E;0BAEGb,Q;0BAQHc,U","sourcesContent":["import { Button, ErrorBoundary, FullScreen, Portal, ProvideUI, Theme, Title, View } from '@o/ui'\nimport { useForceUpdate } from '@o/use-store'\nimport { isDefined } from '@o/utils'\nimport { throttle } from 'lodash'\nimport React, { memo, useCallback, useEffect, useLayoutEffect, useState } from 'react'\nimport { NotFoundBoundary, useCurrentRoute, useLoadingRoute } from 'react-navi'\n\nimport { scrollTo } from './etc/helpers'\nimport { Header } from './Header'\nimport { useScreenSize } from './hooks/useScreenSize'\nimport { useSiteStore } from './SiteStore'\nimport { themes } from './themes'\nimport { BusyIndicator } from './views/BusyIndicator'\nimport { useFadePage } from './views/FadeInView'\nimport { HeaderLink, LinksLeft, LinksRight } from './views/HeaderLink'\n\nconst transition = 'transform ease 300ms'\n\nlet updateLayout = null\n\nexport const usePageTheme = () => {\n  const forceUpdate = useForceUpdate()\n  const route = useCurrentRoute()\n  const curView = route.views.find(x => x && x.type && x.type.theme)\n  const key = `theme-${route.url.pathname.split('/')[1] || ''}`\n  const theme =\n    localStorage.getItem(key) || (curView && curView.type && curView.type.theme) || 'home'\n  return [\n    theme,\n    useCallback(\n      next => {\n        localStorage.setItem(key, next)\n        forceUpdate()\n        updateLayout()\n      },\n      [key],\n    ),\n  ]\n}\n\nconst PageLoading = memo(() => {\n  const loadingRoute = useLoadingRoute()\n  return <BusyIndicator color=\"#FE5C58\" isBusy={!!loadingRoute} delayMs={50} />\n})\n\nexport const Layout = memo((props: any) => {\n  const forceUpdate = useForceUpdate()\n  updateLayout = forceUpdate\n  const siteStore = useSiteStore()\n  const screen = useScreenSize()\n  const sidebarWidth = 300\n  const route = useCurrentRoute()\n  const [theme] = usePageTheme()\n\n  useEffect(() => {\n    siteStore.screenSize = screen\n  }, [screen])\n\n  useEffect(() => {\n    if (window.location.hash) {\n      if (document.querySelector(window.location.hash)) {\n        scrollTo(window.location.hash)\n      }\n    }\n  }, [route])\n\n  useEffect(() => {\n    window.addEventListener(\n      'resize',\n      throttle(() => {\n        siteStore.windowHeight = window.innerHeight\n      }, 64),\n    )\n  }, [])\n\n  const maxHeight = siteStore.showSidebar ? window.innerHeight : siteStore.maxHeight\n\n  useLayoutEffect(() => {\n    document.body.style.background = themes[theme].background.toString()\n  }, [theme])\n\n  return (\n    <ProvideUI themes={themes} activeTheme={theme}>\n      <PageLoading />\n      <PeekHeader isActive={route.views.some(x => x.type && x.type.showPeekHeader)} />\n      <View\n        className={`theme-${theme}`}\n        minHeight=\"100vh\"\n        minWidth=\"100vw\"\n        overflow={isDefined(maxHeight) ? 'hidden' : 'visible'}\n        transition={transition}\n        style={{\n          maxHeight,\n          // WARNING dont have translate here it ruins sticky sidebar\n          transform: siteStore.showSidebar ? `translateX(${-sidebarWidth}px)` : ``,\n        }}\n      >\n        <ErrorBoundary name=\"Site Error\">\n          <NotFoundBoundary render={NotFound}>{props.children}</NotFoundBoundary>\n        </ErrorBoundary>\n      </View>\n      <LayoutSidebar />\n    </ProvideUI>\n  )\n})\n\nconst LayoutSidebar = memo(() => {\n  const siteStore = useSiteStore()\n  const sidebarWidth = 300\n  const Fade = useFadePage()\n\n  const linkProps = {\n    width: '100%',\n    padding: 20,\n    fontSize: 22,\n    textAlign: 'left',\n    onMouseUp: () => {\n      siteStore.toggleSidebar()\n    },\n  }\n\n  return (\n    <Portal prepend style={{ zIndex: 100000000 }}>\n      <Theme name=\"home\">\n        <View\n          nodeRef={Fade.ref}\n          pointerEvents=\"auto\"\n          position=\"fixed\"\n          top={0}\n          right={0}\n          height=\"100vh\"\n          transition={transition}\n          background={bg}\n          style={{\n            width: sidebarWidth,\n            transform: `translateX(${siteStore.showSidebar ? 0 : sidebarWidth}px)`,\n          }}\n        >\n          <Button\n            position=\"absolute\"\n            top={20}\n            right={20}\n            chromeless\n            icon=\"cross\"\n            iconSize={16}\n            zIndex={1000}\n            cursor=\"pointer\"\n            onClick={siteStore.toggleSidebar}\n          />\n          <Fade.FadeProvide>\n            <HeaderLink href=\"/\" {...linkProps}>\n              Home\n            </HeaderLink>\n            <LinksLeft {...linkProps} />\n            <LinksRight {...linkProps} />\n          </Fade.FadeProvide>\n        </View>\n      </Theme>\n    </Portal>\n  )\n})\n\nconst bg = theme => theme.background\n\nfunction NotFound() {\n  return (\n    <View>\n      <Title>Not found</Title>\n    </View>\n  )\n}\n\nconst PeekHeader = memo((props: { isActive?: boolean }) => {\n  const [show, setShow] = useState(false)\n\n  useEffect(() => {\n    const el = document.documentElement\n\n    let top = el.scrollTop\n    let direction: 'down' | 'up' = 'down'\n\n    const onScroll = throttle(() => {\n      const next = el.scrollTop\n      direction = next >= top ? 'down' : 'up'\n\n      // avoid small moves\n      const diff = direction === 'down' ? next - top : top - next\n      if (diff < 150) {\n        return\n      }\n\n      top = next\n\n      if (direction === 'up' && top > 300) {\n        setShow(true)\n      } else {\n        setShow(false)\n      }\n    }, 100)\n\n    window.addEventListener('scroll', onScroll, { passive: true })\n\n    return () => {\n      window.removeEventListener('scroll', onScroll)\n    }\n  }, [])\n\n  if (!props.isActive) {\n    return null\n  }\n\n  return (\n    <Theme name=\"home\">\n      <FullScreen\n        zIndex={100000000}\n        position=\"fixed\"\n        bottom=\"auto\"\n        transition=\"all ease 200ms\"\n        opacity={show ? 1 : 0}\n        transform={{ y: show ? 0 : -40 }}\n        className=\"peek-header\"\n      >\n        <Header slim boxShadow={[[0, 0, 30, [0, 0, 0, 1]]]} />\n      </FullScreen>\n    </Theme>\n  )\n})\n"]},"metadata":{},"sourceType":"module"}