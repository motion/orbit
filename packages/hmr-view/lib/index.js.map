{"version":3,"sources":["../src/index.js"],"names":["proxyReactComponents","componentProxies","__reactComponentProxies","Object","defineProperty","configurable","enumerable","writable","value","filename","components","imports","locals","React","hot","accept","Error","keys","some","key","isInFunction","err","console","warn","error","forceUpdate","wrapWithProxy","ReactClass","uniqueId","displayName","globalUniqueId","instances","update","setTimeout","forEach","get"],"mappings":";;;;;;;;kBAgBwBA,oB;;AAhBxB;;AACA;;;;;;AAEA,IAAIC,yBAAJ;AACA,IAAI,iBAAOC,uBAAX,EAAoC;AAClCD,qBAAmB,iBAAOC,uBAA1B;AACD,CAFD,MAEO;AACLD,qBAAmB,EAAnB;AACAE,SAAOC,cAAP,mBAA8B,yBAA9B,EAAyD;AACvDC,kBAAc,IADyC;AAEvDC,gBAAY,KAF2C;AAGvDC,cAAU,KAH6C;AAIvDC,WAAOP;AAJgD,GAAzD;AAMD;;AAEc,SAASD,oBAAT,OAKZ;AAAA,MAJDS,QAIC,QAJDA,QAIC;AAAA,MAHDC,UAGC,QAHDA,UAGC;AAAA,MAFDC,OAEC,QAFDA,OAEC;AAAA,MADDC,MACC,QADDA,MACC;;AAAA,gCACeD,OADf;AAAA,MACME,KADN;;AAAA,+BAEiBD,MAFjB;AAAA,MAEQE,GAFR,cAEQA,GAFR;;AAID,MAAI,CAACA,GAAD,IAAQ,OAAOA,IAAIC,MAAX,KAAsB,UAAlC,EAA8C;AAC5C,UAAM,IAAIC,KAAJ,CACJ,uEACE,qEADF,GAEE,oEAFF,GAGE,mEAJE,CAAN;AAMD;;AAED,MAAIb,OAAOc,IAAP,CAAYP,UAAZ,EAAwBQ,IAAxB,CAA6B;AAAA,WAAO,CAACR,WAAWS,GAAX,EAAgBC,YAAxB;AAAA,GAA7B,CAAJ,EAAwE;AACtEN,QAAIC,MAAJ,CAAW,eAAO;AAChB,UAAIM,GAAJ,EAAS;AACPC,gBAAQC,IAAR,wDACuDd,QADvD;AAGAa,gBAAQE,KAAR,CAAcH,GAAd;AACD;AACF,KAPD;AAQD;;AAED,MAAMI,cAAc,gCAAe,iBAAOZ,KAAtB,CAApB;;AAEA,SAAO,SAASa,aAAT,CAAuBC,UAAvB,EAAmCC,QAAnC,EAA6C;AAAA,+BACOlB,WACvDkB,QADuD,CADP;AAAA,qDAC1CR,YAD0C;AAAA,QAC1CA,YAD0C,yCAC3B,KAD2B;AAAA,sDACpBS,WADoB;AAAA,QACpBA,WADoB,0CACND,QADM;;;AAKlD,QAAIR,YAAJ,EAAkB;AAChB,aAAOO,UAAP;AACD;;AAED,QAAMG,iBAAiBrB,WAAW,GAAX,GAAiBmB,QAAxC;AACA,QAAI3B,iBAAiB6B,cAAjB,CAAJ,EAAsC;AACpC;AACA,UAAMC,YAAY9B,iBAAiB6B,cAAjB,EAAiCE,MAAjC,CAAwCL,UAAxC,CAAlB;AACAM,iBAAW;AAAA,eAAMF,UAAUG,OAAV,CAAkBT,WAAlB,CAAN;AAAA,OAAX;AACD,KAJD,MAIO;AACLxB,uBAAiB6B,cAAjB,IAAmC,6BAAYH,UAAZ,CAAnC;AACD;;AAED,WAAO1B,iBAAiB6B,cAAjB,EAAiCK,GAAjC,EAAP;AACD,GAnBD;AAoBD","file":"index.js","sourcesContent":["import { getForceUpdate, createProxy } from 'react-proxy'\nimport window from 'global/window'\n\nlet componentProxies\nif (window.__reactComponentProxies) {\n  componentProxies = window.__reactComponentProxies\n} else {\n  componentProxies = {}\n  Object.defineProperty(window, '__reactComponentProxies', {\n    configurable: true,\n    enumerable: false,\n    writable: false,\n    value: componentProxies,\n  })\n}\n\nexport default function proxyReactComponents({\n  filename,\n  components,\n  imports,\n  locals,\n}) {\n  const [React] = imports\n  const [{ hot }] = locals\n\n  if (!hot || typeof hot.accept !== 'function') {\n    throw new Error(\n      'locals[0] does not appear to be a `module` object with Hot Module ' +\n        'replacement API enabled. You should disable react-transform-hmr in ' +\n        'production by using `env` section in Babel configuration. See the ' +\n        'example in README: https://github.com/gaearon/react-transform-hmr'\n    )\n  }\n\n  if (Object.keys(components).some(key => !components[key].isInFunction)) {\n    hot.accept(err => {\n      if (err) {\n        console.warn(\n          `[React Transform HMR] There was an error updating ${filename}:`\n        )\n        console.error(err)\n      }\n    })\n  }\n\n  const forceUpdate = getForceUpdate(window.React)\n\n  return function wrapWithProxy(ReactClass, uniqueId) {\n    const { isInFunction = false, displayName = uniqueId } = components[\n      uniqueId\n    ]\n\n    if (isInFunction) {\n      return ReactClass\n    }\n\n    const globalUniqueId = filename + '$' + uniqueId\n    if (componentProxies[globalUniqueId]) {\n      // console.info('[ReactHMR] ' + displayName)\n      const instances = componentProxies[globalUniqueId].update(ReactClass)\n      setTimeout(() => instances.forEach(forceUpdate))\n    } else {\n      componentProxies[globalUniqueId] = createProxy(ReactClass)\n    }\n\n    return componentProxies[globalUniqueId].get()\n  }\n}\n"]}