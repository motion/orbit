{"version":3,"sources":["../src/index.js"],"names":["proxyReactComponents","componentProxies","__reactComponentProxies","Object","defineProperty","configurable","enumerable","writable","value","reloaded","filename","components","imports","locals","React","module","hot","accept","Error","keys","some","key","isInFunction","err","console","warn","error","forceUpdater","forceUpdate","App","clearErrors","log","instance","wrapWithProxy","ReactClass","uniqueId","displayName","globalUniqueId","push","instances","update","setTimeout","forEach","get","setInterval","length","join"],"mappings":";;;;;;;;kBAkBwBA,oB;;AAlBxB;;AACA;;;;;;AAEA,IAAIC,yBAAJ;AACA,IAAI,iBAAOC,uBAAX,EAAoC;AAClCD,qBAAmB,iBAAOC,uBAA1B;AACD,CAFD,MAEO;AACLD,qBAAmB,EAAnB;AACAE,SAAOC,cAAP,mBAA8B,yBAA9B,EAAyD;AACvDC,kBAAc,IADyC;AAEvDC,gBAAY,KAF2C;AAGvDC,cAAU,KAH6C;AAIvDC,WAAOP;AAJgD,GAAzD;AAMD;;AAED,IAAIQ,WAAW,EAAf;;AAEe,SAAST,oBAAT,OAKZ;AAAA,MAJDU,QAIC,QAJDA,QAIC;AAAA,MAHDC,UAGC,QAHDA,UAGC;AAAA,MAFDC,OAEC,QAFDA,OAEC;AAAA,MADDC,MACC,QADDA,MACC;;AAAA,gCACeD,OADf;AAAA,MACME,KADN;;AAAA,+BAEgBD,MAFhB;AAAA,MAEME,MAFN;;AAAA,gCAGiBF,MAHjB;AAAA,MAGQG,GAHR,eAGQA,GAHR;;AAKD,MAAI,CAACA,GAAD,IAAQ,OAAOA,IAAIC,MAAX,KAAsB,UAAlC,EAA8C;AAC5C,UAAM,IAAIC,KAAJ,CACJ,uEACE,qEADF,GAEE,oEAFF,GAGE,mEAJE,CAAN;AAMD;;AAED;;AAEA,MAAIf,OAAOgB,IAAP,CAAYR,UAAZ,EAAwBS,IAAxB,CAA6B;AAAA,WAAO,CAACT,WAAWU,GAAX,EAAgBC,YAAxB;AAAA,GAA7B,CAAJ,EAAwE;AACtEN,QAAIC,MAAJ,CAAW,eAAO;AAChB,UAAIM,GAAJ,EAAS;AACPC,gBAAQC,IAAR,CACG,qDAAoDf,QAAS,GADhE;AAGAc,gBAAQE,KAAR,CAAcH,GAAd;AACD;AACF,KAPD;AAQD;;AAED,MAAMI,eAAe,gCAAe,iBAAOb,KAAtB,CAArB;AACA,MAAMc,cAAc,SAAdA,WAAc,WAAY;AAC9B,qBAAOC,GAAP,IAAc,iBAAOA,GAAP,CAAWC,WAAzB,IAAwC,iBAAOD,GAAP,CAAWC,WAAX,EAAxC;AACAN,YAAQO,GAAR,CAAY,YAAZ,EAA0BC,QAA1B;AACAA,aAASjB,MAAT,GAAkBA,MAAlB;AACAiB,aAASF,WAAT,IAAwBE,SAASF,WAAT,EAAxB;AACA,WAAOH,aAAaK,QAAb,CAAP;AACD,GAND;AAOA,mBAAOJ,WAAP,GAAqBA,WAArB;;AAEA,SAAO,SAASK,aAAT,CAAuBC,UAAvB,EAAmCC,QAAnC,EAA6C;AAAA,+BACOxB,WACvDwB,QADuD,CADP;AAAA,qDAC1Cb,YAD0C;AAAA,QAC1CA,YAD0C,yCAC3B,KAD2B;AAAA,sDACpBc,WADoB;AAAA,QACpBA,WADoB,0CACND,QADM;;AAKlD;AACA;;AAEA,QAAIb,YAAJ,EAAkB;AAChB,aAAOY,UAAP;AACD;;AAED,QAAMG,iBAAiB3B,WAAW,GAAX,GAAiByB,QAAxC;AACA,QAAIlC,iBAAiBoC,cAAjB,CAAJ,EAAsC;AACpC5B,eAAS6B,IAAT,CAAcF,WAAd;AACA,UAAMG,YAAYtC,iBAAiBoC,cAAjB,EAAiCG,MAAjC,CAAwCN,UAAxC,CAAlB;AACAO,iBAAW;AAAA,eAAMF,UAAUG,OAAV,CAAkBd,WAAlB,CAAN;AAAA,OAAX;AACD,KAJD,MAIO;AACL3B,uBAAiBoC,cAAjB,IAAmC,6BAAYH,UAAZ,CAAnC;AACD;;AAED,WAAOjC,iBAAiBoC,cAAjB,EAAiCM,GAAjC,EAAP;AACD,GAtBD;AAuBD;;AAEDC,YAAY,YAAM;AAChB,MAAInC,SAASoC,MAAb,EAAqB;AACnBrB,YAAQO,GAAR,CAAa,gBAAetB,SAASqC,IAAT,CAAc,IAAd,CAAoB,EAAhD;AACArC,eAAW,EAAX;AACD;AACF,CALD,EAKG,IALH","file":"index.js","sourcesContent":["import { getForceUpdate, createProxy } from 'react-proxy'\nimport window from 'global/window'\n\nlet componentProxies\nif (window.__reactComponentProxies) {\n  componentProxies = window.__reactComponentProxies\n} else {\n  componentProxies = {}\n  Object.defineProperty(window, '__reactComponentProxies', {\n    configurable: true,\n    enumerable: false,\n    writable: false,\n    value: componentProxies,\n  })\n}\n\nlet reloaded = []\n\nexport default function proxyReactComponents({\n  filename,\n  components,\n  imports,\n  locals,\n}) {\n  const [React] = imports\n  const [module] = locals\n  const [{ hot }] = locals\n\n  if (!hot || typeof hot.accept !== 'function') {\n    throw new Error(\n      'locals[0] does not appear to be a `module` object with Hot Module ' +\n        'replacement API enabled. You should disable react-transform-hmr in ' +\n        'production by using `env` section in Babel configuration. See the ' +\n        'example in README: https://github.com/gaearon/react-transform-hmr'\n    )\n  }\n\n  // module\n\n  if (Object.keys(components).some(key => !components[key].isInFunction)) {\n    hot.accept(err => {\n      if (err) {\n        console.warn(\n          `[React Transform HMR] There was an error updating ${filename}:`\n        )\n        console.error(err)\n      }\n    })\n  }\n\n  const forceUpdater = getForceUpdate(window.React)\n  const forceUpdate = instance => {\n    window.App && window.App.clearErrors && window.App.clearErrors()\n    console.log('forceupate', instance)\n    instance.module = module\n    instance.clearErrors && instance.clearErrors()\n    return forceUpdater(instance)\n  }\n  window.forceUpdate = forceUpdate\n\n  return function wrapWithProxy(ReactClass, uniqueId) {\n    const { isInFunction = false, displayName = uniqueId } = components[\n      uniqueId\n    ]\n\n    // attach module to class so it can do shit w it\n    // ReactClass.module = module\n\n    if (isInFunction) {\n      return ReactClass\n    }\n\n    const globalUniqueId = filename + '$' + uniqueId\n    if (componentProxies[globalUniqueId]) {\n      reloaded.push(displayName)\n      const instances = componentProxies[globalUniqueId].update(ReactClass)\n      setTimeout(() => instances.forEach(forceUpdate))\n    } else {\n      componentProxies[globalUniqueId] = createProxy(ReactClass)\n    }\n\n    return componentProxies[globalUniqueId].get()\n  }\n}\n\nsetInterval(() => {\n  if (reloaded.length) {\n    console.log(`[HMR] views: ${reloaded.join(', ')}`)\n    reloaded = []\n  }\n}, 1000)\n"]}