{"version":3,"sources":["../src/fancyElement.js"],"names":["fancyElementFactory","React","electronTags","$","ogCreateElement","createElement","bind","VALID_TAGS","reduce","acc","cur","arrayOfObjectsToObject","arr","res","i","length","TAG_NAME_MAP","title","body","meta","head","item","text","col","IS_BROWSER","window","cancelNextClick","lastMouseDown","Date","now","setTimeout","addDragListener","addEventListener","Gloss","styles","baseStyles","options","css","tagNameOption","tagName","objToCamel","style","newStyle","name","Object","keys","indexOf","helpers","snakeToCamel","fancyElement","type_","props","children","type","Error","toString","onClick","ogClick","args","call","glossUID","constructor","propNames","isTag","finalProps","finalStyles","theme","addStyle","obj","key","val","checkTheme","getRule","push","themeKey","themeStyle","prop","glossProp","extraStyle","snakeCase","notStyle","undefined","isParentStyle","inlineStyle","slice","className","map","x","selectorText","join"],"mappings":"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","file":"fancyElement.js","sourcesContent":["// @flow\nimport * as React from 'react'\nimport deepExtend from 'deep-extend'\nimport tags from 'html-tags'\nimport svgTags from './svgTags'\n\nconst electronTags = ['webview']\n\nconst $ = '$'\nconst ogCreateElement: Function = React.createElement.bind(React)\nconst VALID_TAGS: { [string]: boolean } = [\n  ...tags,\n  ...svgTags,\n  ...electronTags,\n].reduce((acc, cur) => ({ ...acc, [cur]: true }), {})\n\nconst arrayOfObjectsToObject = (arr: Array<?Object>) => {\n  let res = {}\n  for (let i = 0; i < arr.length; i++) {\n    if (!arr[i]) {\n      continue\n    }\n    deepExtend(res, arr[i])\n  }\n  return res\n}\n\n// tags that are dangerous to use\nconst TAG_NAME_MAP = {\n  title: 'div',\n  body: 'div',\n  meta: 'div',\n  head: 'div',\n  item: 'div',\n  text: 'div',\n  col: 'div',\n}\n\nconst IS_BROWSER = typeof window !== 'undefined'\nlet cancelNextClick = false\nlet lastMouseDown = Date.now()\n\n// TODO\n// Put this on fancyElement.setClickInterrupt or something\nsetTimeout(() => {\n  if (IS_BROWSER && window.addDragListener) {\n    window.addEventListener('mousedown', () => {\n      lastMouseDown = Date.now()\n    })\n    window.addEventListener('mouseup', () => {\n      setTimeout(() => {\n        cancelNextClick = false\n      })\n    })\n    window.addDragListener(() => {\n      if (cancelNextClick) {\n        return\n      }\n      if (Date.now() - lastMouseDown < 1000) {\n        cancelNextClick = true\n      }\n    })\n  }\n}, 100)\n\n// factory that returns fancyElement helper\nexport default function fancyElementFactory(Gloss: Gloss, styles?: Object) {\n  const { baseStyles, options, css } = Gloss\n  const tagNameOption = options.tagName\n\n  // Fast object reduce\n  function objToCamel(style) {\n    let newStyle = {}\n    for (const name of Object.keys(style)) {\n      if (name.indexOf('-')) {\n        newStyle[Gloss.helpers.snakeToCamel(name)] = style[name]\n      } else {\n        newStyle[name] = style[name]\n      }\n    }\n    return newStyle\n  }\n\n  function fancyElement(\n    type_: string | Function,\n    props?: Object,\n    ...children: Array<any>\n  ) {\n    let type = type_\n    if (!type) {\n      throw new Error(\n        `Didn't get a valid type: ${type}, children: ${\n          children ? children.toString() : children\n        }`,\n      )\n    }\n    if (IS_BROWSER && props && props.onClick) {\n      const ogClick = props.onClick\n      props.onClick = function(...args) {\n        if (cancelNextClick) {\n          cancelNextClick = false\n          return\n        }\n        return ogClick.call(this, ...args)\n      }\n    }\n    if (!this) {\n      return ogCreateElement(type, props, ...children)\n    }\n\n    let { glossUID } = this.constructor\n    if (props && props.glossUID) {\n      glossUID = props.glossUID\n      delete props.glossUID\n    }\n\n    const propNames = props ? Object.keys(props) : null\n    const isTag = typeof type === 'string'\n    const name: string = !isTag ? `${type.name}` : type\n    const finalProps = {}\n    const finalStyles = []\n\n    const { theme } = this\n\n    const addStyle = (obj, key, val, checkTheme): ?Object => {\n      let style = obj[key]\n      if (!style) {\n        style = obj.getRule ? obj.getRule(key) : obj[key]\n      }\n      if (!style) {\n        return null\n      }\n      // dynamic\n      if (typeof style === 'function') {\n        return css(style(val))\n      } else {\n        finalStyles.push(style)\n      }\n      if (checkTheme && theme) {\n        const themeKey = `${key}--theme`\n        const themeStyle = theme.getRule(themeKey)\n        if (themeStyle) {\n          finalStyles.push(themeStyle)\n        }\n      }\n    }\n\n    if (name) {\n      addStyle(styles, `${name}--${glossUID}`, null, true)\n    }\n\n    let style\n\n    if (propNames) {\n      for (const prop of propNames) {\n        const val = props && props[prop]\n        // style={}\n        if (prop === 'style') {\n          style = { ...style, ...val }\n          continue\n        }\n        // css={}\n        if (options.glossProp && prop === options.glossProp) {\n          if (val && Object.keys(val).length) {\n            // css={}\n            const extraStyle = css(val, { snakeCase: false })\n            style = { ...style, ...extraStyle }\n          }\n          continue\n        }\n        // tagName={}\n        if (tagNameOption && prop === tagNameOption && isTag) {\n          if (!val) {\n            // undefined, ignore\n            continue\n          }\n          if (typeof val !== 'string') {\n            throw new Error(\n              `tagName must be a string (tag: ${name}, type received: ${typeof val})`,\n            )\n          }\n          type = val\n          continue\n        }\n        // after tagname, css, style\n        const notStyle = prop[0] !== $\n        if (notStyle) {\n          // pass props down if not glossProp style prop\n          finalProps[prop] = val\n          continue\n        }\n        // ignore most falsy values (except 0)\n        if (val === false || val === null || val === undefined) {\n          continue\n        }\n        // $$style={}\n        if (baseStyles) {\n          const isParentStyle = prop[1] === $\n          if (isParentStyle) {\n            const inlineStyle = addStyle(styles, prop.slice(2), val, false)\n            if (inlineStyle) {\n              style = { ...style, ...inlineStyle }\n            }\n            continue\n          }\n        }\n        // $style={}\n        if (styles) {\n          const inlineStyle = addStyle(\n            styles,\n            `${prop.slice(1)}--${glossUID}`,\n            val,\n            true,\n          )\n          if (inlineStyle) {\n            style = { ...style, ...objToCamel(inlineStyle) }\n          }\n        }\n      }\n    }\n\n    if (style) {\n      finalProps.style = style\n    }\n\n    // styles => props\n    if (finalStyles.length) {\n      if (isTag) {\n        // tags get className\n        finalProps.className = finalStyles\n          .map(x => x.className || x.selectorText.slice(1))\n          .join(' ')\n\n        // keep original finalStyles\n        if (props && props.className) {\n          if (typeof props.className === 'string') {\n            finalProps.className += ` ${props.className}`\n          }\n        }\n      } else {\n        // children get a style prop\n        if (props) {\n          finalProps.style = objToCamel(\n            arrayOfObjectsToObject([\n              ...finalStyles.map(style => style && style.style),\n              finalProps.style,\n            ]),\n          )\n        }\n      }\n    }\n\n    if (isTag) {\n      if (!finalProps.className) {\n        finalProps.className = type_\n      } else {\n        finalProps.className += ` ${type_}`\n      }\n\n      if (!VALID_TAGS[type]) {\n        type = 'div'\n      }\n      type = TAG_NAME_MAP[type] || type\n    }\n\n    return ogCreateElement(type, finalProps, ...children)\n  }\n\n  return fancyElement\n}\n"]}