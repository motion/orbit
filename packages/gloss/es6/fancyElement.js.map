{"version":3,"sources":["../src/fancyElement.js"],"names":["fancyElementFactory","React","electronTags","$","ogCreateElement","createElement","bind","VALID_TAGS","reduce","acc","cur","arrayOfObjectsToObject","arr","res","i","length","TAG_NAME_MAP","title","body","meta","head","item","text","col","IS_BROWSER","window","cancelNextClick","lastMouseDown","Date","now","setTimeout","addDragListener","addEventListener","Gloss","styles","baseStyles","options","css","tagNameOption","tagName","objToCamel","style","newStyle","Object","keys","name","indexOf","helpers","snakeToCamel","fancyElement","type_","props","type","children","Error","toString","onClick","ogClick","args","call","glossUID","constructor","propNames","isTag","finalProps","finalStyles","theme","addStyle","obj","key","val","checkTheme","getRule","push","themeKey","replace","themeStyle","prop","glossProp","extraStyle","snakeCase","notStyle","undefined","isParentStyle","inlineStyle","slice","className","map","x","selectorText","join"],"mappings":"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","file":"fancyElement.js","sourcesContent":["// @flow\nimport * as React from 'react'\nimport deepExtend from 'deep-extend'\nimport tags from 'html-tags'\nimport svgTags from './svgTags'\n\nconst electronTags = ['webview']\n\nconst $ = '$'\nconst ogCreateElement: Function = React.createElement.bind(React)\nconst VALID_TAGS: { [string]: boolean } = [\n  ...tags,\n  ...svgTags,\n  ...electronTags,\n].reduce((acc, cur) => ({ ...acc, [cur]: true }), {})\n\nconst arrayOfObjectsToObject = (arr: Array<?Object>) => {\n  let res = {}\n  for (let i = 0; i < arr.length; i++) {\n    if (!arr[i]) {\n      continue\n    }\n    deepExtend(res, arr[i])\n  }\n  return res\n}\n\n// tags that are dangerous to use\nconst TAG_NAME_MAP = {\n  title: 'div',\n  body: 'div',\n  meta: 'div',\n  head: 'div',\n  item: 'div',\n  text: 'div',\n  col: 'div',\n}\n\nconst IS_BROWSER = typeof window !== 'undefined'\nlet cancelNextClick = false\nlet lastMouseDown = Date.now()\n\n// TODO\n// Put this on fancyElement.setClickInterrupt or something\nsetTimeout(() => {\n  if (IS_BROWSER && window.addDragListener) {\n    window.addEventListener('mousedown', () => {\n      lastMouseDown = Date.now()\n    })\n    window.addEventListener('mouseup', () => {\n      setTimeout(() => {\n        cancelNextClick = false\n      })\n    })\n    window.addDragListener(() => {\n      if (cancelNextClick) {\n        return\n      }\n      if (Date.now() - lastMouseDown < 1000) {\n        cancelNextClick = true\n      }\n    })\n  }\n}, 100)\n\n// factory that returns fancyElement helper\nexport default function fancyElementFactory(Gloss: Gloss, styles?: Object) {\n  const { baseStyles, options, css } = Gloss\n  const tagNameOption = options.tagName\n\n  // Fast object reduce\n  function objToCamel(style) {\n    let newStyle = {}\n    for (const name of Object.keys(style)) {\n      if (name.indexOf('-')) {\n        newStyle[Gloss.helpers.snakeToCamel(name)] = style[name]\n      } else {\n        newStyle[name] = style[name]\n      }\n    }\n    return newStyle\n  }\n\n  function fancyElement(\n    type_: string | Function,\n    props?: Object,\n    ...children: Array<any>\n  ) {\n    let type = type_\n    if (!type) {\n      throw new Error(\n        `Didn't get a valid type: ${type}, children: ${\n          children ? children.toString() : children\n        }`\n      )\n    }\n    if (IS_BROWSER && props && props.onClick) {\n      const ogClick = props.onClick\n      props.onClick = function(...args) {\n        if (cancelNextClick) {\n          cancelNextClick = false\n          return\n        }\n        return ogClick.call(this, ...args)\n      }\n    }\n    if (!this) {\n      return ogCreateElement(type, props, ...children)\n    }\n\n    let { glossUID } = this.constructor\n    if (props && props.glossUID) {\n      glossUID = props.glossUID\n      delete props.glossUID\n    }\n\n    const propNames = props ? Object.keys(props) : null\n    const isTag = typeof type === 'string'\n    const name: string = !isTag ? `${type.name}` : type\n    const finalProps = {}\n    const finalStyles = []\n\n    const { theme } = this\n\n    const addStyle = (obj, key, val, checkTheme): ?Object => {\n      let style = obj[key]\n      if (!style) {\n        style = obj.getRule ? obj.getRule(key) : obj[key]\n      }\n      if (!style) {\n        return null\n      }\n      // dynamic\n      if (typeof style === 'function') {\n        return css(style(val))\n      } else {\n        finalStyles.push(style)\n      }\n      if (checkTheme && theme) {\n        const themeKey = `${key.replace(\n          `--${glossUID}`,\n          `--${this.themeKey}`\n        )}--theme`\n        const themeStyle = theme.getRule(themeKey)\n        if (themeStyle) {\n          finalStyles.push(themeStyle)\n        }\n      }\n    }\n\n    if (name) {\n      addStyle(styles, `${name}--${glossUID}`, null, true)\n    }\n\n    let style\n\n    if (propNames) {\n      for (const prop of propNames) {\n        const val = props && props[prop]\n        // style={}\n        if (prop === 'style') {\n          style = { ...style, ...val }\n          continue\n        }\n        // css={}\n        if (options.glossProp && prop === options.glossProp) {\n          if (val && Object.keys(val).length) {\n            // css={}\n            const extraStyle = css(val, { snakeCase: false })\n            style = { ...style, ...extraStyle }\n          }\n          continue\n        }\n        // tagName={}\n        if (tagNameOption && prop === tagNameOption && isTag) {\n          if (!val) {\n            // undefined, ignore\n            continue\n          }\n          if (typeof val !== 'string') {\n            throw new Error(\n              `tagName must be a string (tag: ${name}, type received: ${typeof val})`\n            )\n          }\n          type = val\n          continue\n        }\n        // after tagname, css, style\n        const notStyle = prop[0] !== $\n        if (notStyle) {\n          // pass props down if not glossProp style prop\n          finalProps[prop] = val\n          continue\n        }\n        // ignore most falsy values (except 0)\n        if (val === false || val === null || val === undefined) {\n          continue\n        }\n        // $$style={}\n        if (baseStyles) {\n          const isParentStyle = prop[1] === $\n          if (isParentStyle) {\n            const inlineStyle = addStyle(styles, prop.slice(2), val, false)\n            if (inlineStyle) {\n              style = { ...style, ...inlineStyle }\n            }\n            continue\n          }\n        }\n        // $style={}\n        if (styles) {\n          const inlineStyle = addStyle(\n            styles,\n            `${prop.slice(1)}--${glossUID}`,\n            val,\n            true\n          )\n          if (inlineStyle) {\n            style = { ...style, ...objToCamel(inlineStyle) }\n          }\n        }\n      }\n    }\n\n    if (style) {\n      finalProps.style = style\n    }\n\n    // styles => props\n    if (finalStyles.length) {\n      if (isTag) {\n        // tags get className\n        finalProps.className = finalStyles\n          .map(x => x.className || x.selectorText.slice(1))\n          .join(' ')\n\n        // keep original finalStyles\n        if (props && props.className) {\n          if (typeof props.className === 'string') {\n            finalProps.className += ` ${props.className}`\n          }\n        }\n      } else {\n        // children get a style prop\n        if (props) {\n          finalProps.style = objToCamel(\n            arrayOfObjectsToObject([\n              ...finalStyles.map(style => style && style.style),\n              finalProps.style,\n            ])\n          )\n        }\n      }\n    }\n\n    if (isTag) {\n      if (!finalProps.className) {\n        finalProps.className = type_\n      } else {\n        finalProps.className += ` ${type_}`\n      }\n\n      if (!VALID_TAGS[type]) {\n        type = 'div'\n      }\n      type = TAG_NAME_MAP[type] || type\n    }\n\n    return ogCreateElement(type, finalProps, ...children)\n  }\n\n  return fancyElement\n}\n"]}