{"version":3,"sources":["../src/fancyElement.js"],"names":["fancyElementFactory","React","electronTags","$","ogCreateElement","createElement","bind","VALID_TAGS","reduce","acc","cur","arrayOfObjectsToObject","arr","res","i","length","TAG_NAME_MAP","title","body","meta","head","item","text","col","main","IS_BROWSER","window","cancelNextClick","lastMouseDown","Date","now","setTimeout","addDragListener","addEventListener","Gloss","styles","baseStyles","options","css","tagNameOption","tagName","objToCamel","style","newStyle","name","Object","keys","indexOf","helpers","snakeToCamel","addStyle","finalStyles","theme","obj","key","val","checkTheme","getRule","push","themeKey","themeStyle","fancyElement","type_","props","children","type","Error","toString","glossUID","constructor","propNames","isTag","finalProps","prop","ogClick","onClick","args","call","glossProp","extraStyle","snakeCase","notStyle","undefined","isParentStyle","inlineStyle","slice","className","map","x","selectorText","join"],"mappings":"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","file":"fancyElement.js","sourcesContent":["// @flow\nimport * as React from 'react'\nimport deepExtend from 'deep-extend'\nimport tags from 'html-tags'\nimport svgTags from './svgTags'\n\nconst electronTags = ['webview']\n\nconst $ = '$'\nconst ogCreateElement = React.createElement.bind(React)\nconst VALID_TAGS = [...tags, ...svgTags, ...electronTags].reduce(\n  (acc, cur) => ({ ...acc, [cur]: true }),\n  {},\n)\n\nconst arrayOfObjectsToObject = arr => {\n  let res = {}\n  for (let i = 0; i < arr.length; i++) {\n    if (!arr[i]) {\n      continue\n    }\n    deepExtend(res, arr[i])\n  }\n  return res\n}\n\n// tags that are dangerous to use\nconst TAG_NAME_MAP = {\n  title: 'div',\n  body: 'div',\n  meta: 'div',\n  head: 'div',\n  item: 'div',\n  text: 'div',\n  col: 'div',\n  main: 'div',\n}\n\nconst IS_BROWSER = typeof window !== 'undefined'\nlet cancelNextClick = false\nlet lastMouseDown = Date.now()\n\n// TODO\n// Put this on fancyElement.setClickInterrupt or something\nsetTimeout(() => {\n  if (IS_BROWSER && window.addDragListener) {\n    window.addEventListener('mousedown', () => {\n      lastMouseDown = Date.now()\n    })\n    window.addEventListener('mouseup', () => {\n      setTimeout(() => {\n        cancelNextClick = false\n      })\n    })\n    window.addDragListener(() => {\n      if (cancelNextClick) {\n        return\n      }\n      if (Date.now() - lastMouseDown < 1000) {\n        cancelNextClick = true\n      }\n    })\n  }\n}, 100)\n\n// factory that returns fancyElement helper\nexport default function fancyElementFactory(Gloss, styles) {\n  const { baseStyles, options, css } = Gloss\n  const tagNameOption = options.tagName\n\n  // Fast object reduce\n  function objToCamel(style) {\n    let newStyle = {}\n    for (const name of Object.keys(style)) {\n      if (name.indexOf('-')) {\n        newStyle[Gloss.helpers.snakeToCamel(name)] = style[name]\n      } else {\n        newStyle[name] = style[name]\n      }\n    }\n    return newStyle\n  }\n\n  const addStyle = (finalStyles, theme, obj, key, val, checkTheme) => {\n    let style = obj[key]\n    if (!style) {\n      style = obj.getRule ? obj.getRule(key) : obj[key]\n    }\n    if (!style) {\n      return null\n    }\n    // dynamic\n    if (typeof style === 'function') {\n      return css(style(val))\n    } else {\n      finalStyles.push(style)\n    }\n    if (checkTheme && theme) {\n      const themeKey = `${key}--theme`\n      const themeStyle = theme.getRule(themeKey)\n      if (themeStyle) {\n        finalStyles.push(themeStyle)\n      }\n    }\n  }\n\n  function fancyElement(\n    type_: string | Function,\n    props?: Object,\n    ...children: Array<any>\n  ) {\n    let type = type_\n    if (!type) {\n      throw new Error(\n        `Didn't get a valid type: ${type}, children: ${\n          children ? children.toString() : children\n        }`,\n      )\n    }\n    if (!this) {\n      return ogCreateElement(type, props, ...children)\n    }\n    let glossUID = this.constructor.glossUID\n    if (props && props.glossUID) {\n      glossUID = props.glossUID\n      delete props.glossUID\n    }\n    const propNames = props ? Object.keys(props) : null\n    const isTag = typeof type === 'string'\n    const name = !isTag ? `${type.name}` : `${type}`\n    const finalProps = {}\n    const finalStyles = []\n    const theme = this.theme\n\n    if (name) {\n      addStyle(finalStyles, theme, styles, `${name}--${glossUID}`, null, true)\n    }\n\n    let style\n    if (propNames) {\n      for (const prop of propNames) {\n        const val = props && props[prop]\n        // style={}\n        if (prop === 'style') {\n          style = { ...style, ...val }\n          continue\n        }\n        // hacky hacky place to put this, should be out of gloss\n        if (IS_BROWSER && prop === 'onClick' && typeof val === 'function') {\n          const ogClick = val\n          finalProps.onClick = function(...args) {\n            if (cancelNextClick) {\n              cancelNextClick = false\n              return\n            }\n            return ogClick.call(this, ...args)\n          }\n          continue\n        }\n        // css={}\n        if (options.glossProp && prop === options.glossProp) {\n          if (val && Object.keys(val).length) {\n            // css={}\n            const extraStyle = css(val, { snakeCase: false })\n            style = { ...style, ...extraStyle }\n          }\n          continue\n        }\n        // also hacky to put this here\n        // tagName={}\n        if (tagNameOption && prop === tagNameOption && isTag) {\n          // lets it be optionally undefined/false\n          if (val) {\n            type = val\n          }\n          continue\n        }\n        // after tagname, css, style\n        const notStyle = prop[0] !== $\n        if (notStyle) {\n          // pass props down if not glossProp style prop\n          finalProps[prop] = val\n          continue\n        }\n        // ignore most falsy values (except 0)\n        if (val === false || val === null || val === undefined) {\n          continue\n        }\n        // $$style={}\n        if (baseStyles) {\n          const isParentStyle = prop[1] === $\n          if (isParentStyle) {\n            const inlineStyle = addStyle(\n              finalStyles,\n              theme,\n              styles,\n              prop.slice(2),\n              val,\n              false,\n            )\n            if (inlineStyle) {\n              style = { ...style, ...inlineStyle }\n            }\n            continue\n          }\n        }\n        // $style={}\n        if (styles) {\n          const inlineStyle = addStyle(\n            finalStyles,\n            theme,\n            styles,\n            `${prop.slice(1)}--${glossUID}`,\n            val,\n            true,\n          )\n          if (inlineStyle) {\n            style = { ...style, ...objToCamel(inlineStyle) }\n          }\n        }\n      }\n    }\n\n    if (style) {\n      finalProps.style = style\n    }\n\n    // styles => props\n    if (finalStyles.length) {\n      if (isTag) {\n        // tags get className\n        finalProps.className = finalStyles\n          .map(x => x.className || x.selectorText.slice(1))\n          .join(' ')\n\n        // keep original finalStyles\n        if (props && props.className) {\n          if (typeof props.className === 'string') {\n            finalProps.className += ` ${props.className}`\n          }\n        }\n      } else {\n        // children get a style prop\n        if (props) {\n          finalProps.style = objToCamel(\n            arrayOfObjectsToObject([\n              ...finalStyles.map(style => style && style.style),\n              finalProps.style,\n            ]),\n          )\n        }\n      }\n    }\n\n    if (isTag) {\n      if (name !== 'div') {\n        if (!finalProps.className) {\n          finalProps.className = name\n        } else {\n          finalProps.className += ` ${name}`\n        }\n        if (!VALID_TAGS[type]) {\n          type = 'div'\n        }\n      }\n      type = TAG_NAME_MAP[name] || type\n    }\n\n    return ogCreateElement(type, finalProps, ...children)\n  }\n\n  return fancyElement\n}\n"]}