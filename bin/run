#!/bin/bash

. $(dirname $0)/__/common
cd $ROOT

ACTION=$1
ARG1=$2

trap killgroup SIGINT
killgroup() {
  kill 0
}

if [ "$ACTION" = "backend" ]; then
  echo "Open about:inspect in Chrome to debug Node"
  compose up ${@:2}
elif [ "$ACTION" = "electron" ]; then
  cd apps/electron
  npm run watch &
  sleep 3
  npm start &
  wait
  echo "done"
elif [ "$ACTION" =  "web" ]; then
  if [ ! -d "$ROOT/packages/ui/lib" ]; then
    echo "Make sure to run 'build --watch' before running web"
    exit 0
  fi

  cd apps/web
  if [ "$ARG1" = "--clean" ]; then
    motion watch --debug --disable-cache &
  elif [ "$ARG1" = "--prod" ]; then
    npm run start-prod &
  elif [ "$ARG1" = "--webpack" ]; then
    node scripts/run.js
  else
    motion watch --debug ${@:2} &
  fi

  cd $ROOT/apps/api
  if [ "$ARG1" = "--prod" ]; then
    npm run start-prod &
  else
    npm run start-dev &
  fi

  wait
else
  npm run $1 ${@:2}
fi
