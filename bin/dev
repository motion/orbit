#!/bin/bash

. $(dirname $0)/__common
cd $ROOT

set -e

# set dev context
export KUBECONFIG=infra/keys/kubes/dev
kubectl config use-context minikube

export ENV="dev"

ACTION=$1

# PRE RUN
if minikube docker-env > /dev/null 2>&1; then
  eval $(minikube docker-env)
else
  echo "minikube is not running..."
  minikube start
  sleep 3
fi

# RUN
if [ "$ACTION" = "ui" ]; then
  minikube dashboard
else
  bin/__kubes ${@:1}
fi

# POST RUN
if [ "$ACTION" = "stop" ]; then
  minikube stop
fi
