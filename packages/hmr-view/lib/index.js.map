{"version":3,"sources":["../src/index.js"],"names":["getForceUpdate","createProxy","window","componentProxies","__reactComponentProxies","Object","defineProperty","configurable","enumerable","writable","value","reloaded","proxyReactComponents","filename","components","imports","locals","React","module","hot","accept","Error","keys","some","key","isInFunction","err","console","warn","error","forceUpdater","forceUpdate","instance","handleHotReload","wrapWithProxy","ReactClass","uniqueId","displayName","globalUniqueId","push","instances","update","setTimeout","forEach","get","setInterval","length","log","join"],"mappings":"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","file":"index.js","sourcesContent":["import { getForceUpdate, createProxy } from 'react-proxy'\nimport window from 'global/window'\n\nlet componentProxies\nif (window.__reactComponentProxies) {\n  componentProxies = window.__reactComponentProxies\n} else {\n  componentProxies = {}\n  Object.defineProperty(window, '__reactComponentProxies', {\n    configurable: true,\n    enumerable: false,\n    writable: false,\n    value: componentProxies,\n  })\n}\n\nwindow.componentProxies = componentProxies\n\nlet reloaded = []\n\nexport default function proxyReactComponents({\n  filename,\n  components,\n  imports,\n  locals,\n}) {\n  const [React] = imports\n  const [module] = locals\n  const [{ hot }] = locals\n\n  if (!hot || typeof hot.accept !== 'function') {\n    throw new Error(\n      'locals[0] does not appear to be a `module` object with Hot Module ' +\n        'replacement API enabled. You should disable react-transform-hmr in ' +\n        'production by using `env` section in Babel configuration. See the ' +\n        'example in README: https://github.com/gaearon/react-transform-hmr'\n    )\n  }\n\n  // module\n\n  if (Object.keys(components).some(key => !components[key].isInFunction)) {\n    hot.accept(err => {\n      if (err) {\n        console.warn(\n          `[React Transform HMR] There was an error updating ${filename}:`\n        )\n        console.error(err)\n      }\n    })\n  }\n\n  const forceUpdater = getForceUpdate(window.React)\n  const forceUpdate = instance => {\n    instance.handleHotReload && instance.handleHotReload(module)\n    return forceUpdater(instance)\n  }\n  window.forceUpdate = forceUpdate\n\n  return function wrapWithProxy(ReactClass, uniqueId) {\n    const { isInFunction = false, displayName = uniqueId } = components[\n      uniqueId\n    ]\n\n    // attach module to class so it can do shit w it\n    // ReactClass.module = module\n\n    if (isInFunction) {\n      return ReactClass\n    }\n\n    const globalUniqueId = filename + '$' + uniqueId\n    if (componentProxies[globalUniqueId]) {\n      reloaded.push(displayName)\n      const instances = componentProxies[globalUniqueId].update(ReactClass)\n      setTimeout(() => instances.forEach(forceUpdate))\n    } else {\n      componentProxies[globalUniqueId] = createProxy(ReactClass)\n    }\n\n    return componentProxies[globalUniqueId].get()\n  }\n}\n\nsetInterval(() => {\n  if (reloaded.length) {\n    console.log(`[HMR] views: ${reloaded.join(', ')}`)\n    reloaded = []\n  }\n}, 1000)\n"]}