#!/bin/bash

. $(dirname $0)/__/common

if [ "$(realpath .)" = "$ROOT" ]; then
  echo "building.... $(pwd)"
  # build
  if [ "$1" = "" ]; then
    ARGS=${@:1}
    bin/in store-hmr npm run build
    bin/in black npm run build
    (bin/in ui npm run build) &
    (bin/in gloss npm run build) &
    (bin/in reactron npm run build) &
    wait
    (cd app && npx tsc --build $ARGS) &
    wait
  fi
  # build --watch
  if [ "$1" = "--watch" ]; then
    ARGS=${@:2}
    (bin/in gloss npm run watch) &
    (bin/in reactron npm run watch) &
    (bin/in ui npm run watch) &
    (bin/in store-hmr npm run watch) &
    (cd app && ../node_modules/.bin/tsc --build --watch --preserveWatchOutput $ARGS) &
    wait
  fi
  exit 0
fi

