#!/bin/bash

. $(dirname $0)/__/common

PACKAGE=$1
APP=$(basename $(pwd))

if [ "$PACKAGE" ]; then
  if [[ ! -f "./package.json" ]]; then
    exit 1
  fi

  JOT_PACKAGES=$(cat package.json | grep "@mcro/.*:")
  sed -i.bak '/@mcro/c\ /' ./package.json # remove @mcro/ and add .bak
  # cp package.json package.json2
  yarn add $PACKAGE ${@:2}
  # newlyInstalledPackages=$(comm -23 package.json package.json2) && rm package.json2
  sed -i.bak2 '//c' ./package.json
  REPLACE="  \"dependencies\": {\n$JOT_PACKAGES\n"
  echo $REPLACE
  sed -i.bak2 "/\"dependencies\"/c $REPLACE" ./package.json
fi

rm -f yarn.lock

cd $ROOT
cat ./node_modules/lerna/bin/lerna.js

./node_modules/lerna/bin/lerna.js install --scope @mcro/$APP

cd -
