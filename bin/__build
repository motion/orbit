#!/bin/bash

. $(dirname $0)/__common
cd $ROOT

echo "namespace $NAMESPACE"

APP=$1

buildapi() {
  docker build -t motion/starter-api -f infra/images/api.dockerfile .
  docker push motion/starter-api
}

buildpublic() {
  docker build -t motion/starter-public -f infra/images/public.dockerfile .
  docker push motion/starter-public
}

if [ "$APP" = "all" ]; then
  buildapi &
  buildpublic
elif [ "$APP" = "public" ]; then
  buildpublic
elif [ "$APP" = "api" ]; then
  buildapi
fi

trap "trap - SIGTERM && kill -- -$$" SIGINT SIGTERM EXIT
