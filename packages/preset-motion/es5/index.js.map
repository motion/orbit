{"version":3,"sources":["../src/index.js"],"names":["module","exports","context","givenOpts","opts","disable","noAsync","async","isAsync","getPlugin","name","find","x","plugin","require","resolve","envOpts","Object","assign","targets","node","nodeTarget","exclude","env","config","plugins","decoratorName","decorator","jsxIf","rootPathPrefix","rootPathSuffix","rootSuffix","transforms","transform","imports","locals","presets","filter"],"mappings":";;AAAAA,OAAOC,OAAP,GAAiB,UAASC,OAAT,EAAkBC,SAAlB,EAA6B;AAC5C,MAAMC,OAAOD,aAAa,EAA1B;AACA,MAAME,UAAUD,KAAKC,OAAL,IAAgB,EAAhC;AACA,MAAMC,UAAUF,KAAKG,KAAL,KAAe,KAA/B;AACA,MAAMC,UAAU,CAACF,OAAjB;AACA,MAAMG,YAAY,SAAZA,SAAY,CAACC,IAAD,EAAON,IAAP,EAAgB;AAChC,QAAIC,QAAQM,IAAR,CAAa;AAAA,aAAKC,MAAMF,IAAX;AAAA,KAAb,CAAJ,EAAmC;AACjC,aAAO,IAAP;AACD;AACD,QAAMG,SAASC,QAAQC,OAAR,CAAgBL,IAAhB,CAAf;AACA,WAAON,OAAO,CAACS,MAAD,EAAST,IAAT,CAAP,GAAwBS,MAA/B;AACD,GAND;;AAQA,MAAMG,UAAUC,OAAOC,MAAP,CACd;AACEC,aAAS;AACPC,YAAMhB,KAAKiB,UAAL,IAAmB;AADlB,KADX;AAIEC,aAASd,UACL,CAAC,uBAAD,EAA0B,8BAA1B,CADK,GAEL;AANN,GADc,EASdJ,KAAKmB,GAAL,IAAY,EATE,CAAhB;;AAYA,MAAMC,SAAS;AACbC,aAAS;AACP;AACA;AACAhB,cAAU,0DAAV,CAHO,EAIPA,UAAU,yCAAV,CAJO,EAKPA,UAAU,qBAAV,CALO,EAMPA,UAAU,uBAAV,EAAmC;AACjCiB,qBAAetB,KAAKuB,SAAL,IAAkB,MADA;AAEjCC,aAAOxB,KAAKwB,KAAL,IAAc;AAFY,KAAnC,CANO,EAUPnB,UAAU,0BAAV,EAAsC,CACpC;AACEoB,sBAAgB,GADlB;AAEEC,sBACE,OAAO1B,KAAK2B,UAAZ,KAA2B,WAA3B,GAAyC,KAAzC,GAAiD3B,KAAK2B;AAH1D,KADoC,CAAtC,CAVO,EAiBPtB,UAAU,WAAV,EAAuB;AACrBiB,qBAAetB,KAAKuB,SAAL,IAAkB,MADZ;AAErBK,kBAAY,CACV;AACEC,mBAAWnB,QAAQC,OAAR,CAAgB,gBAAhB,CADb;AAEEmB,iBAAS,CAAC,OAAD,CAFX;AAGEC,gBAAQ,CAAC,QAAD;AAHV,OADU;AAFS,KAAvB,CAjBO,CADI;AA6BbC,aAAShC,KAAKgC,OAAL,IAAgB,CACvB3B,UAAU,kBAAV,EAA8BO,OAA9B,CADuB,EAEvBP,UAAU,oBAAV,CAFuB,EAGvBD,WAAWC,UAAU,oCAAV,CAHY,EAIvBH,WAAWG,UAAU,sBAAV,CAJY;AA7BZ,GAAf;;AAqCAe,SAAOC,OAAP,GAAiBD,OAAOC,OAAP,CAAeY,MAAf,CAAsB;AAAA,WAAK,CAAC,CAACzB,CAAP;AAAA,GAAtB,CAAjB;AACAY,SAAOY,OAAP,GAAiBZ,OAAOY,OAAP,CAAeC,MAAf,CAAsB;AAAA,WAAK,CAAC,CAACzB,CAAP;AAAA,GAAtB,CAAjB;;AAEA,SAAOY,MAAP;AACD,CAlED","file":"index.js","sourcesContent":["module.exports = function(context, givenOpts) {\n  const opts = givenOpts || {}\n  const disable = opts.disable || []\n  const noAsync = opts.async === false\n  const isAsync = !noAsync\n  const getPlugin = (name, opts) => {\n    if (disable.find(x => x === name)) {\n      return null\n    }\n    const plugin = require.resolve(name)\n    return opts ? [plugin, opts] : plugin\n  }\n\n  const envOpts = Object.assign(\n    {\n      targets: {\n        node: opts.nodeTarget || 'current',\n      },\n      exclude: isAsync\n        ? ['transform-regenerator', 'transform-async-to-generator']\n        : [],\n    },\n    opts.env || {}\n  )\n\n  const config = {\n    plugins: [\n      // getPlugin('babel-plugin-transform-runtime'),\n      // order important here\n      getPlugin('babel-plugin-transform-decorators-legacy-without-clutter'),\n      getPlugin('babel-plugin-transform-class-properties'),\n      getPlugin('babel-plugin-sitrep'),\n      getPlugin('@mcro/gloss/transform', {\n        decoratorName: opts.decorator || 'view',\n        jsxIf: opts.jsxIf || true,\n      }),\n      getPlugin('babel-plugin-root-import', [\n        {\n          rootPathPrefix: '~',\n          rootPathSuffix:\n            typeof opts.rootSuffix === 'undefined' ? 'src' : opts.rootSuffix,\n        },\n      ]),\n      getPlugin('@mcro/hmr', {\n        decoratorName: opts.decorator || 'view',\n        transforms: [\n          {\n            transform: require.resolve('@mcro/hmr-view'),\n            imports: ['react'],\n            locals: ['module'],\n          },\n        ],\n      }),\n    ],\n    presets: opts.presets || [\n      getPlugin('babel-preset-env', envOpts),\n      getPlugin('babel-preset-react'),\n      isAsync && getPlugin('babel-preset-stage-1-without-async'),\n      noAsync && getPlugin('babel-preset-stage-1'),\n    ],\n  }\n\n  config.plugins = config.plugins.filter(x => !!x)\n  config.presets = config.presets.filter(x => !!x)\n\n  return config\n}\n"]}