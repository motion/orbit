{"version":3,"sources":["../src/index.js"],"names":["proxyReactComponents","componentProxies","__reactComponentProxies","Object","defineProperty","configurable","enumerable","writable","value","reloaded","filename","components","imports","locals","React","module","hot","accept","Error","some","key","isInFunction","err","console","warn","error","forceUpdater","forceUpdate","instance","handleHotReload","wrapWithProxy","ReactClass","uniqueId","displayName","globalUniqueId","push","instances","update","setTimeout","forEach","get","setInterval","length","log","join"],"mappings":";;;;;;;;;;;;;;kBAoBwBA,oB;;AApBxB;;AACA;;;;;;AAEA,IAAIC,yBAAJ;AACA,IAAI,iBAAOC,uBAAX,EAAoC;AAClCD,qBAAmB,iBAAOC,uBAA1B;AACD,CAFD,MAEO;AACLD,qBAAmB,EAAnB;AACAE,SAAOC,cAAP,mBAA8B,yBAA9B,EAAyD;AACvDC,kBAAc,IADyC;AAEvDC,gBAAY,KAF2C;AAGvDC,cAAU,KAH6C;AAIvDC,WAAOP;AAJgD,GAAzD;AAMD;;AAED,iBAAOA,gBAAP,GAA0BA,gBAA1B;;AAEA,IAAIQ,WAAW,EAAf;;AAEe,SAAST,oBAAT,OAKZ;AAAA,MAJDU,QAIC,QAJDA,QAIC;AAAA,MAHDC,UAGC,QAHDA,UAGC;AAAA,MAFDC,OAEC,QAFDA,OAEC;AAAA,MADDC,MACC,QADDA,MACC;;AAAA,8CACeD,OADf;AAAA,MACME,KADN;;AAAA,6CAEgBD,MAFhB;AAAA,MAEME,MAFN;;AAAA,8CAGiBF,MAHjB;AAAA,MAGQG,GAHR,eAGQA,GAHR;;AAKD,MAAI,CAACA,GAAD,IAAQ,OAAOA,IAAIC,MAAX,KAAsB,UAAlC,EAA8C;AAC5C,UAAM,IAAIC,KAAJ,CACJ,uEACE,qEADF,GAEE,oEAFF,GAGE,mEAJE,CAAN;AAMD;;AAED;;AAEA,MAAI,oBAAYP,UAAZ,EAAwBQ,IAAxB,CAA6B;AAAA,WAAO,CAACR,WAAWS,GAAX,EAAgBC,YAAxB;AAAA,GAA7B,CAAJ,EAAwE;AACtEL,QAAIC,MAAJ,CAAW,eAAO;AAChB,UAAIK,GAAJ,EAAS;AACPC,gBAAQC,IAAR,CACG,qDAAoDd,QAAS,GADhE;AAGAa,gBAAQE,KAAR,CAAcH,GAAd;AACD;AACF,KAPD;AAQD;;AAED,MAAMI,eAAe,gCAAe,iBAAOZ,KAAtB,CAArB;AACA,MAAMa,cAAc,SAAdA,WAAc,WAAY;AAC9BC,aAASC,eAAT,IAA4BD,SAASC,eAAT,CAAyBd,MAAzB,CAA5B;AACA,WAAOW,aAAaE,QAAb,CAAP;AACD,GAHD;AAIA,mBAAOD,WAAP,GAAqBA,WAArB;;AAEA,SAAO,SAASG,aAAT,CAAuBC,UAAvB,EAAmCC,QAAnC,EAA6C;AAAA,+BACOrB,WACvDqB,QADuD,CADP;AAAA,qDAC1CX,YAD0C;AAAA,QAC1CA,YAD0C,yCAC3B,KAD2B;AAAA,sDACpBY,WADoB;AAAA,QACpBA,WADoB,0CACND,QADM;;AAKlD;AACA;;AAEA,QAAIX,YAAJ,EAAkB;AAChB,aAAOU,UAAP;AACD;;AAED,QAAMG,iBAAiBxB,WAAW,GAAX,GAAiBsB,QAAxC;AACA,QAAI/B,iBAAiBiC,cAAjB,CAAJ,EAAsC;AACpCzB,eAAS0B,IAAT,CAAcF,WAAd;AACA,UAAMG,YAAYnC,iBAAiBiC,cAAjB,EAAiCG,MAAjC,CAAwCN,UAAxC,CAAlB;AACAO,iBAAW;AAAA,eAAMF,UAAUG,OAAV,CAAkBZ,WAAlB,CAAN;AAAA,OAAX;AACD,KAJD,MAIO;AACL1B,uBAAiBiC,cAAjB,IAAmC,6BAAYH,UAAZ,CAAnC;AACD;;AAED,WAAO9B,iBAAiBiC,cAAjB,EAAiCM,GAAjC,EAAP;AACD,GAtBD;AAuBD;;AAEDC,YAAY,YAAM;AAChB,MAAIhC,SAASiC,MAAb,EAAqB;AACnBnB,YAAQoB,GAAR,CAAa,gBAAelC,SAASmC,IAAT,CAAc,IAAd,CAAoB,EAAhD;AACAnC,eAAW,EAAX;AACD;AACF,CALD,EAKG,IALH","file":"index.js","sourcesContent":["import { getForceUpdate, createProxy } from 'react-proxy'\nimport window from 'global/window'\n\nlet componentProxies\nif (window.__reactComponentProxies) {\n  componentProxies = window.__reactComponentProxies\n} else {\n  componentProxies = {}\n  Object.defineProperty(window, '__reactComponentProxies', {\n    configurable: true,\n    enumerable: false,\n    writable: false,\n    value: componentProxies,\n  })\n}\n\nwindow.componentProxies = componentProxies\n\nlet reloaded = []\n\nexport default function proxyReactComponents({\n  filename,\n  components,\n  imports,\n  locals,\n}) {\n  const [React] = imports\n  const [module] = locals\n  const [{ hot }] = locals\n\n  if (!hot || typeof hot.accept !== 'function') {\n    throw new Error(\n      'locals[0] does not appear to be a `module` object with Hot Module ' +\n        'replacement API enabled. You should disable react-transform-hmr in ' +\n        'production by using `env` section in Babel configuration. See the ' +\n        'example in README: https://github.com/gaearon/react-transform-hmr'\n    )\n  }\n\n  // module\n\n  if (Object.keys(components).some(key => !components[key].isInFunction)) {\n    hot.accept(err => {\n      if (err) {\n        console.warn(\n          `[React Transform HMR] There was an error updating ${filename}:`\n        )\n        console.error(err)\n      }\n    })\n  }\n\n  const forceUpdater = getForceUpdate(window.React)\n  const forceUpdate = instance => {\n    instance.handleHotReload && instance.handleHotReload(module)\n    return forceUpdater(instance)\n  }\n  window.forceUpdate = forceUpdate\n\n  return function wrapWithProxy(ReactClass, uniqueId) {\n    const { isInFunction = false, displayName = uniqueId } = components[\n      uniqueId\n    ]\n\n    // attach module to class so it can do shit w it\n    // ReactClass.module = module\n\n    if (isInFunction) {\n      return ReactClass\n    }\n\n    const globalUniqueId = filename + '$' + uniqueId\n    if (componentProxies[globalUniqueId]) {\n      reloaded.push(displayName)\n      const instances = componentProxies[globalUniqueId].update(ReactClass)\n      setTimeout(() => instances.forEach(forceUpdate))\n    } else {\n      componentProxies[globalUniqueId] = createProxy(ReactClass)\n    }\n\n    return componentProxies[globalUniqueId].get()\n  }\n}\n\nsetInterval(() => {\n  if (reloaded.length) {\n    console.log(`[HMR] views: ${reloaded.join(', ')}`)\n    reloaded = []\n  }\n}, 1000)\n"]}