#!/bin/bash

set +e

# hard source clear
rm -r ./example-workspace/dist/node_modules/.cache
rm -r ./example-workspace/dist/.cache
rm -r ./apps/*/dist/node_modules/.cache

rm -r app/*/tsconfig.tsbuildinfo || true
rm -r apps/*/tsconfig.tsbuildinfo || true
rm -r packages/*/tsconfig.tsbuildinfo || true

rm -r app/*/npm-debug.log.* || true
rm -r packages/*/npm-debug.log.* || true
rm -r app/*/_ || true
rm -r apps/*/_ || true
rm -r projects-*/*/_ || true
rm -r packages/*/_ || true

rm -r app/*/shrinkwrap.yaml || true
rm -r apps/*/shrinkwrap.yaml || true
rm -r packages/*/shrinkwrap.yaml || true
rm -r projects/*/shrinkwrap.yaml || true

rm -r app/*/package-lock.json || true
rm -r apps/*/package-lock.json || true
rm -r packages/*/package-lock.json || true
rm -r projects/*/package-lock.json || true

if [[ "$1" = "--all" ]]; then
  rm -r node_modules || true
  rm -r app/*/node_modules || true
  rm -r apps/*/node_modules || true
  rm -r projects-*/*/node_modules || true
  rm -r packages/*/node_modules || true
fi

# echo "re-installing with `yarn --check-files` to ensure everything installed"
# yarn install --check-files

echo "run bootstrap and build once with build"
